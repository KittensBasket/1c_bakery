
Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	// 1. ПОДГОТОВКА: Указываем системе, что мы будем записывать движения в эти регистры.
    Движения.ОстаткиПродукции.Записывать        = Истина; 
    Движения.ВзаиморасчетыСПоставщиками.Записывать = Истина;
    
    // Инициализируем переменную для подсчета общей суммы документа
    СуммаДокумента = 0;
    
    // 2. ДВИЖЕНИЯ ПО МАТЕРИАЛАМ: Проходим по каждой строке табличной части "Материалы"
    Для Каждого СтрокаТЧ Из Материалы Цикл
        
        // Создаем новое движение (запись) в регистре "ОстаткиПродукции"
        Движение = Движения.ОстаткиПродукции.Добавить();
        
        // Указываем, что это ПРИХОД (увеличение остатков)
        Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
        
        // Указываем дату движения
        Движение.Период     = Дата;
        
        // Заполняем измерения (что пришло)
        Движение.Продукция  = СтрокаТЧ.Материал; 
        
        // Заполняем ресурсы (сколько пришло)
        Движение.Количество = СтрокаТЧ.Количество;
        
        // Накапливаем общую сумму
        СуммаДокумента = СуммаДокумента + СтрокаТЧ.Сумма;
        
        Движение.Сумма      = СтрокаТЧ.Сумма;
        
    КонецЦикла;
    
    // 3. ДВИЖЕНИЯ ПО ВЗАИМОРАСЧЕТАМ: Создаем запись по поставщику на общую сумму
    Если СуммаДокумента > 0 Тогда
    
        // Создаем новое движение (запись) в регистре "ВзаиморасчетыСПоставщиками"
        Движение = Движения.ВзаиморасчетыСПоставщиками.Добавить();
        
        // Указываем, что это ПРИХОД (увеличение нашей задолженности перед поставщиком)
        Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
        
        // Указываем дату движения
        Движение.Период      = Дата;
        
        // Заполняем измерения (с кем возникла задолженность)
        Движение.Поставщик   = Поставщик;
        
        // Заполняем ресурсы (сумма задолженности)
        Движение.СуммаВзаиморасчетов = СуммаДокумента;
        
    КонецЕсли;
    
    // После завершения процедуры, система 1С автоматически запишет все накопленные
    // движения в базу данных, так как мы установили .Записывать = Истина в начале.
КонецПроцедуры

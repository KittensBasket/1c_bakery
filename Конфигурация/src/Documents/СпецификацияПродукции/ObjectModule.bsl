
Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	// 1. Указываем, что документ будет записывать движения в регистр
    Движения.СпецификацииПродукции.Записывать = Истина;
    
    // 2. Проверка заполнения шапки
    Если Не ЗначениеЗаполнено(Продукция) Или КоличествоПродукцииНаБазу <= 0 Тогда
        Отказ = Истина;
        Сообщить("Необходимо заполнить Продукцию и Базовое количество.");
        Возврат;
    КонецЕсли;
    
    // 3. Перенос строк из табличной части в Регистр Сведений
    Для Каждого СтрокаТЧ Из СоставМатериалов Цикл
        
        Если Не ЗначениеЗаполнено(СтрокаТЧ.Материал) Или СтрокаТЧ.КоличествоМатериала <= 0 Тогда
            Продолжить; // Пропускаем пустые или нулевые строки
        КонецЕсли;
        
        // Создаем новую запись в Регистре Сведений
        Движение = Движения.СпецификацииПродукции.Добавить();
        
        // Заполняем поле Период (важно для истории!)
        Движение.Период = Дата; 
        
        // 4. Заполнение Измерений (ключей)
        Движение.Продукция = Продукция;
        Движение.Материал = СтрокаТЧ.Материал;
        
        // 5. Заполнение Ресурсов и Реквизитов (данных)
        Движение.КоличествоМатериала = СтрокаТЧ.КоличествоМатериала;
        Движение.ЕдиницаИзмерения = СтрокаТЧ.ЕдиницаИзмерения;
        
        Движение.КоличествоПродукцииНаБазу = КоличествоПродукцииНаБазу;
        Движение.ЕдиницаПродукции = ЕдиницаПродукции;
        
    КонецЦикла;
КонецПроцедуры


// Проверка КПП (9 символов)
&НаКлиенте
Функция ПроверитьКПП(Знач КПП)
    
    // Проверка на пустое значение
    Если КПП = "" Тогда
        Возврат Ложь;
    КонецЕсли;
    
    // Проверка длины
    Если СтрДлина(КПП) <> 9 Тогда
        Возврат Ложь;
    КонецЕсли;
    
    // 9 символов - цифры (код налогового органа и причина постановки, порядковый номер)
    Для i = 1 По 9 Цикл
        Если Найти("0123456789", Сред(КПП, i, 1)) = 0 Тогда
            Возврат Ложь;
        КонецЕсли;
    КонецЦикла;
    Возврат Истина;
КонецФункции

&НаКлиенте
Процедура КПППриИзменении(Элемент)
	КПП = Объект.КПП;
    
    Если Не ПустаяСтрока(КПП) Тогда
        Если Не ПроверитьКПП(КПП) Тогда
            Сообщение = Новый СообщениеПользователю;
            Сообщение.Текст = "Введен некорректный КПП!";
            Сообщение.Поле = "КПП";
            Сообщение.Сообщить();
            
            Элементы.КПП.ЦветФона = WebЦвета.Красный;
        Иначе
            Элементы.КПП.ЦветФона = WebЦвета.Белый;
        КонецЕсли;
    КонецЕсли;
КонецПроцедуры

// Проверка ИНН физического лица (12 цифр) или юридического лица (10 цифр)
Функция ПроверитьИНН(Знач ИНН) 
    
    ИНН = СокрЛП(ИНН);
    
    // Проверка на пустое значение
    Если ИНН = "" Тогда
        Возврат Ложь;
    КонецЕсли;
    
    // Проверка длины
    Длина = СтрДлина(ИНН);
    Если Не (Длина = 10 ИЛИ Длина = 12) Тогда
        Возврат Ложь;
    КонецЕсли;
    
    // Проверка что все символы - цифры
    Для i = 1 По Длина Цикл
        Если Найти("0123456789", Сред(ИНН, i, 1)) = 0 Тогда
            Возврат Ложь;
        КонецЕсли;
    КонецЦикла;
    
    // Проверка контрольной суммы для 10-значного ИНН
    Если Длина = 10 Тогда
        КонтрольнаяСумма = 0;
        Коэффициенты = Новый Массив;
        Коэффициенты.Добавить(2); Коэффициенты.Добавить(4);
        Коэффициенты.Добавить(10); Коэффициенты.Добавить(3);
        Коэффициенты.Добавить(5); Коэффициенты.Добавить(9);
        Коэффициенты.Добавить(4); Коэффициенты.Добавить(6);
        Коэффициенты.Добавить(8);
        
        Для i = 1 По 9 Цикл
            Цифра = Число(Сред(ИНН, i, 1));
            КонтрольнаяСумма = КонтрольнаяСумма + Цифра * Коэффициенты[i-1];
        КонецЦикла;
        
        КонтрольноеЧисло = КонтрольнаяСумма % 11;
        Если КонтрольноеЧисло = 10 Тогда
            КонтрольноеЧисло = 0;
        КонецЕсли;
        
        Если КонтрольноеЧисло <> Число(Сред(ИНН, 10, 1)) Тогда
            Возврат Ложь;
        КонецЕсли;
        
    Иначе // Проверка контрольной суммы для 12-значного ИНН
        
        // Первая контрольная сумма
        КонтрольнаяСумма1 = 0;
        Коэффициенты1 = Новый Массив;
        Коэффициенты1.Добавить(7); Коэффициенты1.Добавить(2);
        Коэффициенты1.Добавить(4); Коэффициенты1.Добавить(10);
        Коэффициенты1.Добавить(3); Коэффициенты1.Добавить(5);
        Коэффициенты1.Добавить(9); Коэффициенты1.Добавить(4);
        Коэффициенты1.Добавить(6); Коэффициенты1.Добавить(8);
        
        Для i = 1 По 10 Цикл
            Цифра = Число(Сред(ИНН, i, 1));
            КонтрольнаяСумма1 = КонтрольнаяСумма1 + Цифра * Коэффициенты1[i-1];
        КонецЦикла;
        
        КонтрольноеЧисло1 = КонтрольнаяСумма1 % 11;
        Если КонтрольноеЧисло1 = 10 Тогда
            КонтрольноеЧисло1 = 0;
        КонецЕсли;
        
        Если КонтрольноеЧисло1 <> Число(Сред(ИНН, 11, 1)) Тогда
            Возврат Ложь;
        КонецЕсли;
        
        // Вторая контрольная сумма
        КонтрольнаяСумма2 = 0;
        Коэффициенты2 = Новый Массив;
        Коэффициенты2.Добавить(3); Коэффициенты2.Добавить(7);
        Коэффициенты2.Добавить(2); Коэффициенты2.Добавить(4);
        Коэффициенты2.Добавить(10); Коэффициенты2.Добавить(3);
        Коэффициенты2.Добавить(5); Коэффициенты2.Добавить(9);
        Коэффициенты2.Добавить(4); Коэффициенты2.Добавить(6);
        Коэффициенты2.Добавить(8);
        
        Для i = 1 По 11 Цикл
            Цифра = Число(Сред(ИНН, i, 1));
            КонтрольнаяСумма2 = КонтрольнаяСумма2 + Цифра * Коэффициенты2[i-1];
        КонецЦикла;
        
        КонтрольноеЧисло2 = КонтрольнаяСумма2 % 11;
        Если КонтрольноеЧисло2 = 10 Тогда
            КонтрольноеЧисло2 = 0;
        КонецЕсли;
        
        Если КонтрольноеЧисло2 <> Число(Сред(ИНН, 12, 1)) Тогда
            Возврат Ложь;
        КонецЕсли;
        
    КонецЕсли;
    
    Возврат Истина;
    
КонецФункции

&НаКлиенте
Процедура ИННПриИзменении(Элемент)
	ИНН = Объект.ИНН;
    
    Если Не ПустаяСтрока(ИНН) Тогда
        Если Не ПроверитьИНН(ИНН) Тогда
            Сообщение = Новый СообщениеПользователю;
            Сообщение.Текст = "Введен некорректный ИНН!";
            Сообщение.Поле = "ИНН";
            Сообщение.Сообщить();
            
            Элементы.ИНН.ЦветФона = WebЦвета.Красный;
        Иначе
            Элементы.ИНН.ЦветФона = WebЦвета.Белый;
        КонецЕсли;
    КонецЕсли;
КонецПроцедуры
